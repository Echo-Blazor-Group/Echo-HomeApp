@page "/realtorfirm/create"
@using Echo_HomeApp.Client.Components.Components
@inject HttpClient httpClient
@inject NavigationManager NavigationManager
@rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false))
@{
    /// <summary>
    /// Author: Samed Salman
    /// This page is for creating a new realtor firm.
    /// </summary>
}

<PageTitle>Add new realtor firm</PageTitle>

<h1>Add new realtor firm</h1>

<div class="row">
    <div class="col-md-4">
    <EditForm method="post" Model="@RealtorFirm" OnValidSubmit="AddRealtorFirmAsync" FormName="create" >
        <DataAnnotationsValidator />
            <RealtorFirmEditForm /> @* The form itself is in a separate component *@
        <div class="mb-3">
            <Button Type="ButtonType.Link" To="/realtorfirms" Color="ButtonColor.Secondary"><Icon Name="IconName.ArrowReturnLeft" /> Cancel</Button>
            <Button Type="ButtonType.Submit" Color="ButtonColor.Primary"><Icon Name="IconName.ClipboardPlus" /> Add</Button>
        </div>
    </EditForm>
    </div>
</div>


@code {

    // TODO: (Samed) bryta ut RealtorFirmEditForm till egen component, som kan återanvändas på Editsidan.

    [SupplyParameterFromForm]
    public RealtorFirmPostDTO RealtorFirm { get; set; } = new();

    private async Task AddRealtorFirmAsync()
    {
        // Http-post call on form submit
        await httpClient.PostAsJsonAsync("https://localhost:7190/api/RealtorFirm", RealtorFirm);

        // if(response.IsSuccessStatusCode)
        // {
            // TODO: (Samed) Get Location in Http-response and extract id

            // TODO: (Samed) Redirect to to details page

            // In the meantime, navigate to list of realtor firms
            NavigationManager.NavigateTo("/realtorfirms");
        // }
        //else: show fail toastmessage

        // TODO: (Samed) Show success Toast-message on next page
    }

    // Testat:
    // - lägga till inställning (AllowAutoRedirect = false) i program.cs - gav inget
    // - kollat Postman, där Location kommer med
}
